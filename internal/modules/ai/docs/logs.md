{"level":"info","ts":"2026-02-06T19:01:28.913+0800","msg":"assistant chat stream start","tenant_user_id":"U1766924990899297500","session_id":"ASItIaSFgyxoP","agent_id":"AGGSnZMdh3yIa","scope":"","top_k":0,"question_len":27,"func":"service.(*assistantServiceImpl).ChatStream","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/application/service/assistant_service.go","line":160}
{"level":"info","ts":"2026-02-06T19:01:28.913+0800","msg":"assistant request received","query_id":"q_QkFmVgZzHOVx_1770375688913296100","tenant_user_id":"U1766924990899297500","session_id":"ASItIaSFgyxoP","agent_id":"AGGSnZMdh3yIa","scope":"","top_k":0,"question_len":27,"question":"ä¸€åˆ†é’Ÿåæé†’æˆ‘å–æ°´","func":"pipeline.(*AssistantPipeline).loadMemoryNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":59}
{"level":"info","ts":"2026-02-06T19:01:28.916+0800","msg":"assistant load memory done","session_id":"ASItIaSFgyxoP","is_new":false,"history_count":12,"func":"pipeline.(*AssistantPipeline).loadMemoryNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":126}
{"level":"info","ts":"2026-02-06T19:01:29.304+0800","msg":"ai retrieve done","query_id":"q_QVHhu2fQCpXx_1770375689304562800","tenant_user_id":"U1766924990899297500","question":"ä¸€åˆ†é’Ÿåæé†’æˆ‘å–æ°´","top_k":5,"score_threshold":0,"filter_expr":"tenant_user_id == \"U1766924990899297500\" && kb_id == 1","total_hits":5,"returned_count":5,"chunk_ids":"125,138,101,65,68","search_ms":359,"post_process_ms":0,"duration_ms":362,"is_empty":false,"func":"pipeline.(*RetrievePipeline).buildResultNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/retrieve_graph.go","line":255}
{"level":"info","ts":"2026-02-06T19:01:29.304+0800","msg":"assistant retrieve done","query_id":"q_QkFmVgZzHOVx_1770375688913296100","kb_id":1,"chunks":5,"retrieve_ms":362,"func":"pipeline.(*AssistantPipeline).retrieveNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":190}
{"level":"info","ts":"2026-02-06T19:01:29.307+0800","msg":"assistant build prompt done","query_id":"q_QkFmVgZzHOVx_1770375688913296100","prompt_msgs":16,"history_msgs":12,"retrieved_chunks":5,"prompt":"[{\"role\":\"system\",\"content\":\"### ç”¨æˆ·ä¸Šä¸‹æ–‡\\nç”¨æˆ·ID: U1766924990899297500\\nç”¨æˆ·åç§°: 1213123\\nå½“å‰æ—¶é—´: 2026-02-06T19:01:29+08:00 (æ—¶åŒº: +08:00)\\nä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸Šå·²æä¾›çš„ç”¨æˆ·ä¿¡æ¯æ¥å›ç­”ä¸è¯¥ç”¨æˆ·ç›¸å…³çš„é—®é¢˜ï¼Œä½†ä¸å¾—è‡†é€ æœªæä¾›çš„ä¿¡æ¯ã€‚\"},{\"role\":\"system\",\"content\":\"ä½ æ˜¯ OmniLink çš„å…¨å±€ AI ä¸ªäººåŠ©æ‰‹ï¼Œå›ç­”å¿…é¡»åŸºäºç”¨æˆ·æƒé™å†…çš„èŠå¤©/è”ç³»äºº/ç¾¤ç»„ä¿¡æ¯ã€‚\\n[System Prompt]\\n### åŸºç¡€èº«ä»½\\nä½ æ˜¯ç”± OmniLink æ„å»ºçš„å…¨å±€ AI ä¸ªäººåŠ©æ‰‹ã€‚ä½ çš„æ ¸å¿ƒç›®æ ‡æ˜¯è¾…åŠ©ç”¨æˆ·ç®¡ç†ç¤¾äº¤å…³ç³»ã€å¤„ç†æ¶ˆæ¯å¹¶æä¾›æ™ºèƒ½é—®ç­”ã€‚\\n\\n### æ ¸å¿ƒèƒ½åŠ›ä¸çº¦æŸ\\n1. **æ•°æ®ä¸¥è°¨æ€§**ï¼š\\n   - å¯¹äºç”¨æˆ·çš„ç§æœ‰æ•°æ®ï¼ˆå¥½å‹åˆ—è¡¨ã€ç¾¤ç»„ä¿¡æ¯ã€èŠå¤©è®°å½•ï¼‰ï¼Œ**å¿…é¡»** é€šè¿‡å·¥å…·è°ƒç”¨ï¼ˆToolsï¼‰æˆ–æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰è·å–ï¼Œ**ä¸¥ç¦** è‡†é€ ã€‚\\n   - è‹¥å·¥å…·æˆ–æ£€ç´¢æœªè¿”å›ç»“æœï¼Œè¯·æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·\\\"æœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯\\\"ï¼Œä¸è¦ç¼–é€ å‡æ•°æ®ã€‚\\n\\n2. **å·¥å…·ä½¿ç”¨ç­–ç•¥**ï¼š\\n   - å½“ç”¨æˆ·è¯¢é—®\\\"æˆ‘æœ‰æ²¡æœ‰å¥½å‹X\\\"ã€\\\"å‘æ¶ˆæ¯ç»™Y\\\"ã€\\\"æœ€è¿‘ç¾¤é‡ŒèŠäº†ä»€ä¹ˆ\\\"ç­‰å®æ—¶æ“ä½œç±»é—®é¢˜æ—¶ï¼Œ**ä¼˜å…ˆ** å°è¯•è°ƒç”¨å¯¹åº”çš„ MCP å·¥å…·ã€‚\\n   - è‹¥æ— å¯ç”¨å·¥å…·ï¼Œè¯·å‘ç”¨æˆ·è§£é‡Šå½“å‰èƒ½åŠ›å—é™ã€‚\\n\\n3. **å›ç­”é£æ ¼**ï¼š\\n   - ç®€æ´ã€ä¸“ä¸šã€å‹å¥½ã€‚\\n   - æ¶‰åŠæ•æ„Ÿéšç§ï¼ˆå¦‚æ‰‹æœºå·ã€è¯¦ç»†åœ°å€ï¼‰æ—¶ï¼Œè¯·è¿›è¡Œè„±æ•å¤„ç†æˆ–å†æ¬¡ç¡®è®¤ã€‚\\n\\n### çŸ¥è¯†åº“èŒƒå›´\\nä½ æ‹¥æœ‰å…¨å±€çŸ¥è¯†åº“çš„è®¿é—®æƒé™ï¼Œå¯ä»¥å›ç­”å…³äº OmniLink å¹³å°åŠŸèƒ½ã€é€šç”¨ç™¾ç§‘ç­‰é—®é¢˜ã€‚\\n\\n### æ‰©å±•èƒ½åŠ›ï¼ˆé¢„ç•™ï¼‰\\næœªæ¥ä½ å°†æ”¯æŒï¼š\\n- ç¦»çº¿æ€»ç»“ï¼šç”¨æˆ·ç™»å½•æ—¶è‡ªåŠ¨æ¨é€ç¦»çº¿æœŸé—´çš„é‡ç‚¹æ¶ˆæ¯æ‘˜è¦\\n- ä¸»åŠ¨é€šçŸ¥ï¼šå®šæ—¶æé†’ã€æ—¥æŠ¥æ¨é€ç­‰\\n- æ™ºèƒ½æŒ‡ä»¤ï¼šé€šè¿‡ /todoã€/remind ç­‰å¿«æ·å‘½ä»¤å¿«é€Ÿæ‰§è¡Œä»»åŠ¡\\n[User Persona]\\næ‚¨çš„ä¸“å±æ™ºèƒ½åŠ©ç†ï¼Œè´Ÿè´£æ¶ˆæ¯ç®¡ç†ã€æ™ºèƒ½é—®ç­”å’Œä¸»åŠ¨é€šçŸ¥\"},{\"role\":\"assistant\",\"content\":\"å·²ä¸ºæ‚¨åˆ›å»º**1åˆ†é’Ÿåï¼ˆ2026-02-06 18:20:50+08:00ï¼‰çš„å–æ°´æé†’**ï¼Œç³»ç»Ÿå°†åœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨æ¨é€é€šçŸ¥ã€Œè®°å¾—å–æ°´å•¦ï¼ã€~ ğŸ˜Š\"},{\"role\":\"user\",\"content\":\"ä¸€åˆ†é’Ÿåæé†’æˆ‘å–æ°´\"},{\"role\":\"user\",\"content\":\"ä¸€åˆ†é’Ÿåæé†’æˆ‘å–æ°´\"},{\"role\":\"assistant\",\"content\":\"å·²ä¸ºæ‚¨åˆ›å»º**1åˆ†é’Ÿåï¼ˆ2026-02-06 18:27:29+08:00ï¼‰çš„å–æ°´æé†’**ï¼Œç³»ç»Ÿå°†åœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨æ¨é€é€šçŸ¥ã€Œè®°å¾—å–æ°´å•¦ï¼ã€~ ğŸ˜Š\"},{\"role\":\"assistant\",\"content\":\"å·²ä¸ºæ‚¨åˆ›å»º**1åˆ†é’Ÿåï¼ˆ2026-02-06 18:30:04+08:00ï¼‰çš„å–æ°´æé†’**ï¼Œç³»ç»Ÿå°†åœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨æ¨é€é€šçŸ¥ã€Œè®°å¾—å–æ°´å•¦ï¼ã€~ ğŸ˜Š\"},{\"role\":\"user\",\"content\":\"ä¸€åˆ†é’Ÿåæé†’æˆ‘å–æ°´\"},{\"role\":\"assistant\",\"content\":\"å·²ä¸ºæ‚¨åˆ›å»º**1åˆ†é’Ÿåï¼ˆ2026-02-06 18:36:25+08:00ï¼‰çš„å–æ°´æé†’**ï¼Œç³»ç»Ÿå°†åœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨æ¨é€é€šçŸ¥ã€Œè®°å¾—å–æ°´å•¦ï¼ã€~ ğŸ˜Š\"},{\"role\":\"user\",\"content\":\"ä¸€åˆ†é’Ÿåæé†’æˆ‘å–æ°´\"},{\"role\":\"assistant\",\"content\":\"å·²ä¸ºæ‚¨åˆ›å»º**1åˆ†é’Ÿåï¼ˆ2026-02-06 18:37:56+08:00ï¼‰çš„å–æ°´æé†’**ï¼Œç³»ç»Ÿå°†åœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨æ¨é€é€šçŸ¥ã€Œè®°å¾—å–æ°´å•¦ï¼ã€~ ğŸ˜Š\"},{\"role\":\"user\",\"content\":\"ä¸€åˆ†é’Ÿåæé†’æˆ‘å–æ°´\"},{\"role\":\"assistant\",\"content\":\"å·²ä¸ºæ‚¨åˆ›å»º**1åˆ†é’Ÿåï¼ˆ2026-02-06 18:55:56+08:00ï¼‰çš„å–æ°´æé†’**ï¼Œç³»ç»Ÿå°†åœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨æ¨é€é€šçŸ¥ã€Œè®°å¾—å–æ°´å•¦ï¼ã€~ ğŸ˜Š\"},{\"role\":\"user\",\"content\":\"ä¸€åˆ†é’Ÿåæé†’æˆ‘å–æ°´\"},{\"role\":\"system\",\"content\":\"ä»¥ä¸‹æ˜¯æ£€ç´¢åˆ°çš„ç›¸å…³ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š\\n[chunk:125] 1213123[U1766924990899297500]-\\u003eU1766922807113409200[U1766922807113409200](18:39:17): ä½ å¥½\\n1213123[U1766924990899297500]-\\u003eU1766922807113409200[U1766922807113409200](18:39:21): 11111 (æ¥æº: chat_private/U1766922807113409200, å¾—åˆ†: 0.479)\\n[chunk:138] 1213123[U1766924990899297500]-\\u003eG8GrEN26qR0S[G8GrEN26qR0S](18:55:22): é¡ºä¾¿å¸®æˆ‘è¯·ä¸ªå‡\\n1213123[U1766924990899297500]-\\u003eG8GrEN26qR0S[G8GrEN26qR0S](18:55:24): å¬è§æ²¡ (æ¥æº: chat_group/G8GrEN26qR0S, å¾—åˆ†: 0.479)\\n[chunk:101] 1213123(01:47:56): èƒ½ä¸èƒ½æ˜å¤©å¸®æˆ‘è¯·ä¸ªå‡ (æ¥æº: chat_private/UpqQSI2oUdLb, å¾—åˆ†: 0.474)\\n[chunk:65] 1213123(02:00:56): å¯¹ä¸èµ· (æ¥æº: chat_private/UpqQSI2oUdLb, å¾—åˆ†: 0.465)\\n[chunk:68] 1213123(02:01:02): å°çŒ«ä¸å°å¿ƒç¢°åˆ°é”®ç›˜äº† (æ¥æº: chat_private/UpqQSI2oUdLb, å¾—åˆ†: 0.455)\\n\"},{\"role\":\"user\",\"content\":\"ä¸€åˆ†é’Ÿåæé†’æˆ‘å–æ°´\"}]","tools":"[{\"Name\":\"contact_get_info\",\"Desc\":\"è·å–æŒ‡å®šè”ç³»äººçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤´åƒã€ç­¾åã€æ€§åˆ«ã€ç”Ÿæ—¥ç­‰JSONæ•°æ®\",\"Extra\":null},{\"Name\":\"contact_get_new_list\",\"Desc\":\"è·å–å¾…å¤„ç†çš„å¥½å‹ç”³è¯·åˆ—è¡¨ï¼ŒåŒ…æ‹¬ç”³è¯·äººä¿¡æ¯ã€ç”³è¯·æ¶ˆæ¯ç­‰JSONæ•°æ®\",\"Extra\":null},{\"Name\":\"contact_list_friends\",\"Desc\":\"è·å–ç”¨æˆ·çš„å¥½å‹åˆ—è¡¨ï¼Œè¿”å›å¥½å‹åŸºæœ¬ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¤´åƒã€çŠ¶æ€ï¼‰JSONæ•°æ®\",\"Extra\":null},{\"Name\":\"contact_my_groups\",\"Desc\":\"è·å–ç”¨æˆ·å·²åŠ å…¥çš„ç¾¤ç»„åˆ—è¡¨ï¼Œè¿”å›ç¾¤ç»„åŸºæœ¬ä¿¡æ¯JSONæ•°æ®\",\"Extra\":null},{\"Name\":\"contact_pass_friend_apply\",\"Desc\":\"åŒæ„å¥½å‹ç”³è¯·ã€‚**éœ€è¦ç”¨æˆ·ç¡®è®¤åæ‰ä¼šæ‰§è¡Œ**\",\"Extra\":null},{\"Name\":\"contact_refuse_friend_apply\",\"Desc\":\"æ‹’ç»å¥½å‹ç”³è¯·ã€‚**éœ€è¦ç”¨æˆ·ç¡®è®¤åæ‰ä¼šæ‰§è¡Œ**\",\"Extra\":null},{\"Name\":\"contact_search_groups\",\"Desc\":\"æ ¹æ®ç¾¤ç»„åç§°æ¨¡ç³Šæœç´¢ç¾¤ç»„ã€‚è¿”å›ç¾¤ç»„IDã€åç§°ã€å¤´åƒç­‰JSONæ•°æ®\",\"Extra\":null},{\"Name\":\"contact_search_users\",\"Desc\":\"æ ¹æ®ç”¨æˆ·æ˜µç§°æˆ–ç”¨æˆ·åæ¨¡ç³Šæœç´¢ç”¨æˆ·ï¼Œç”¨äºæŸ¥æ‰¾è”ç³»äººã€‚è¿”å›ç”¨æˆ·IDã€æ˜µç§°ã€å¤´åƒç­‰JSONæ•°æ®\",\"Extra\":null},{\"Name\":\"get_current_time\",\"Desc\":\"è·å–å½“å‰ç³»ç»Ÿæ—¶é—´\",\"Extra\":null},{\"Name\":\"group_get_info\",\"Desc\":\"è·å–æŒ‡å®šç¾¤ç»„çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¾¤åã€å…¬å‘Šã€æˆå‘˜æ•°ã€ç¾¤ä¸»ç­‰JSONæ•°æ®\",\"Extra\":null},{\"Name\":\"group_get_members\",\"Desc\":\"è·å–æŒ‡å®šç¾¤ç»„çš„æˆå‘˜åˆ—è¡¨ï¼ŒåŒ…æ‹¬æˆå‘˜çš„ç”¨æˆ·åã€æ˜µç§°ã€å¤´åƒã€è§’è‰²ç­‰JSONæ•°æ®\",\"Extra\":null},{\"Name\":\"group_join\",\"Desc\":\"ç”³è¯·åŠ å…¥ç¾¤èŠã€‚**éœ€è¦ç”¨æˆ·ç¡®è®¤åæ‰ä¼šæ‰§è¡Œ**\",\"Extra\":null},{\"Name\":\"group_leave\",\"Desc\":\"é€€å‡ºç¾¤èŠã€‚**éœ€è¦ç”¨æˆ·ç¡®è®¤åæ‰ä¼šæ‰§è¡Œ**\",\"Extra\":null},{\"Name\":\"list_my_agents\",\"Desc\":\"åˆ—å‡ºå½“å‰ç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰ Agentï¼Œç”¨äºè·å– agent_id\",\"Extra\":null},{\"Name\":\"list_supported_events\",\"Desc\":\"åˆ—å‡ºç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰è§¦å‘äº‹ä»¶ Key\",\"Extra\":null},{\"Name\":\"manage_ai_job\",\"Desc\":\"åˆ›å»ºæˆ–ç®¡ç† AI è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚æ”¯æŒå®šæ—¶(cron)ã€ä¸€æ¬¡æ€§(once)ã€äº‹ä»¶é©±åŠ¨(event)ä¸‰ç§æ¨¡å¼ã€‚ç”¨äºç”Ÿæˆå‘é€ç»™Agentæ‰§è¡Œçš„æŒ‡ä»¤ã€‚\",\"Extra\":null},{\"Name\":\"push_notification\",\"Desc\":\"ä¸»åŠ¨å‘ç”¨æˆ·æ¨é€é€šçŸ¥æ¶ˆæ¯ã€‚å½“éœ€è¦æé†’ç”¨æˆ·ã€å‘é€æ—¥æŠ¥æˆ–ä¸»åŠ¨å‘ŠçŸ¥ä¿¡æ¯æ—¶ä½¿ç”¨ã€‚æ¶ˆæ¯ä¼šè‡ªåŠ¨ä¿å­˜å¹¶æ¨é€åˆ°ç”¨æˆ·å‰ç«¯ã€‚\",\"Extra\":null}]","func":"pipeline.(*AssistantPipeline).buildPromptNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":324}
{"level":"info","ts":"2026-02-06T19:01:40.512+0800","msg":"assistant chat model iteration","query_id":"q_QkFmVgZzHOVx_1770375688913296100","iteration":1,"tool_calls":1,"llm_ms":11204,"func":"pipeline.(*AssistantPipeline).chatModelNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":371}
{"level":"info","ts":"2026-02-06T19:01:40.512+0800","msg":"assistant tool call start","query_id":"q_QkFmVgZzHOVx_1770375688913296100","tool_name":"manage_ai_job","tool_args":"{\"action\": \"create\", \"trigger_type\": \"once\", \"trigger_value\": \"2026-02-06T11:02:29Z\", \"prompt\": \"è¯·æ¨é€é€šçŸ¥ç»™ç”¨æˆ·ï¼Œå†…å®¹ä¸ºï¼š'è®°å¾—å–æ°´å•¦ï¼'\"}","tool_args_len":159,"func":"pipeline.(*AssistantPipeline).toolsNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":415}
{"level":"info","ts":"2026-02-06T19:01:40.512+0800","msg":"manage_ai_job request","user_id":"U1766924990899297500","action":"create","trigger_type":"once","trigger_value":"2026-02-06T11:02:29Z","agent_id":"AGGSnZMdh3yIa","prompt_len":59,"func":"handlers.(*JobManagementHandler).handleManageJob","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/mcp/server/handlers/job_management_handler.go","line":103}
{"level":"info","ts":"2026-02-06T19:01:40.514+0800","msg":"manage_ai_job create resolved","user_id":"U1766924990899297500","agent_id":"AGGSnZMdh3yIa","session_id":"ASItIaSFgyxoP","trigger_type":"once","trigger_value":"2026-02-06T11:02:29Z","func":"handlers.(*JobManagementHandler).handleManageJob","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/mcp/server/handlers/job_management_handler.go","line":161}
{"level":"info","ts":"2026-02-06T19:01:40.515+0800","msg":"ai job create one time","tenant_user_id":"U1766924990899297500","agent_id":"AGGSnZMdh3yIa","session_id":"ASItIaSFgyxoP","trigger_at":"2026-02-06T11:02:29Z","prompt_len":59,"func":"service.(*aiJobServiceImpl).CreateOneTimeJob","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/application/service/job_service.go","line":153}
{"level":"info","ts":"2026-02-06T19:01:40.518+0800","msg":"manage_ai_job create once success","user_id":"U1766924990899297500","agent_id":"AGGSnZMdh3yIa","session_id":"ASItIaSFgyxoP","trigger_at":"2026-02-06T11:02:29Z","func":"handlers.(*JobManagementHandler).handleManageJob","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/mcp/server/handlers/job_management_handler.go","line":181}
{"level":"info","ts":"2026-02-06T19:01:40.519+0800","msg":"assistant tool executed","query_id":"q_QkFmVgZzHOVx_1770375688913296100","tool_name":"manage_ai_job","response_len":83,"tool_result":"{\"content\":[{\"type\":\"text\",\"text\":\"Created One-time Job at 2026-02-06T11:02:29Z\"}]}","found":true,"error":false,"func":"pipeline.(*AssistantPipeline).toolsNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":468}
{"level":"info","ts":"2026-02-06T19:01:40.519+0800","msg":"assistant tools node done","query_id":"q_QkFmVgZzHOVx_1770375688913296100","tools_executed":1,"tools_ms":6,"func":"pipeline.(*AssistantPipeline).toolsNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":477}
{"level":"info","ts":"2026-02-06T19:01:48.788+0800","msg":"assistant chat model iteration","query_id":"q_QkFmVgZzHOVx_1770375688913296100","iteration":2,"tool_calls":0,"llm_ms":8268,"func":"pipeline.(*AssistantPipeline).chatModelNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":371}
{"level":"info","ts":"2026-02-06T19:01:49.748+0800","msg":"assistant persist done","session_id":"ASItIaSFgyxoP","query_id":"q_QkFmVgZzHOVx_1770375688913296100","total_iterations":2,"func":"pipeline.(*AssistantPipeline).persistNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/assistant_graph.go","line":557}
{"level":"info","ts":"2026-02-06T19:01:49.748+0800","msg":"assistant chat stream done","tenant_user_id":"U1766924990899297500","session_id":"ASItIaSFgyxoP","query_id":"q_QkFmVgZzHOVx_1770375688913296100","answer_len":150,"func":"service.(*assistantServiceImpl).ChatStream.func1","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/application/service/assistant_service.go","line":228}
{"level":"info","ts":"2026-02-06T19:01:49.748+0800","msg":"assistant chat stream completed","uuid":"U1766924990899297500","func":"http.(*AssistantHandler).ChatStream","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/interface/http/assistant_handler.go","line":118}
[GIN] 2026/02/06 - 19:01:49 | 200 |   20.8348743s |       127.0.0.1 | POST     "/ai/assistant/chat/stream"
[GIN] 2026/02/06 - 19:01:54 | 200 |        2.16ms |       127.0.0.1 | GET      "/ai/assistant/sessions/AS320msNd6WJG/messages?limit=100&offset=0"
[GIN] 2026/02/06 - 19:02:25 | 200 |          1m0s |       127.0.0.1 | GET      "/wss?client_id=U1766924990899297500&token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1dWlkIjoiVTE3NjY5MjQ5OTA4OTkyOTc1MDAiLCJ1c2VybmFtZSI6InF3ZXF3ZSIsImlzcyI6Ik9tbmlMaW5rIiwiZXhwIjoxNzcwNDU0Mjg5LCJuYmYiOjE3NzAzNjc4ODksImlhdCI6MTc3MDM2Nzg4OX0.cyiI7RZuL4sIRwei4wbE-GcA5Ki3ocq6YSikiXp3iBM"
{"level":"info","ts":"2026-02-06T19:02:29.912+0800","msg":"executing ai job instance","inst_id":13,"func":"service.(*aiJobServiceImpl).ExecuteInstance","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/application/service/job_service.go","line":231}
{"level":"info","ts":"2026-02-06T19:02:29.912+0800","msg":"ai job execute start","inst_id":13,"job_def_id":0,"tenant_user_id":"U1766924990899297500","agent_id":"AGGSnZMdh3yIa","session_id":"ASItIaSFgyxoP","prompt_len":59,"func":"service.(*aiJobServiceImpl).ExecuteInstance","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/application/service/job_service.go","line":235}
{"level":"info","ts":"2026-02-06T19:02:29.912+0800","msg":"job execution started","tenant_user_id":"U1766924990899297500","agent_id":"AGGSnZMdh3yIa","session_id":"ASItIaSFgyxoP","prompt_len":59,"func":"pipeline.(*JobExecutionPipeline).loadContextNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":50}
{"level":"info","ts":"2026-02-06T19:02:30.092+0800","msg":"ai retrieve done","query_id":"q_QlbfdQL03siP_1770375750092319900","tenant_user_id":"U1766924990899297500","question":"è¯·æ¨é€é€šçŸ¥ç»™ç”¨æˆ·ï¼Œå†…å®¹ä¸ºï¼š'è®°å¾—å–æ°´å•¦ï¼'","top_k":5,"score_threshold":0,"filter_expr":"tenant_user_id == \"U1766924990899297500\" && kb_id == 1","total_hits":5,"returned_count":5,"chunk_ids":"138,125,136,63,103","search_ms":173,"post_process_ms":0,"duration_ms":180,"is_empty":false,"func":"pipeline.(*RetrievePipeline).buildResultNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/retrieve_graph.go","line":255}
{"level":"info","ts":"2026-02-06T19:02:30.092+0800","msg":"job execution rag retrieved","items":5,"func":"pipeline.(*JobExecutionPipeline).retrieveNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":104}
{"level":"info","ts":"2026-02-06T19:02:30.092+0800","msg":"job execution prompt built","system_len":1000,"prompt_len":59,"citations":5,"func":"pipeline.(*JobExecutionPipeline).buildPromptNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":136}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution llm response","iteration":0,"tool_calls":1,"answer_len":0,"func":"pipeline.(*JobExecutionPipeline).chatModelNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":181}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution invoking tool","tool_name":"push_notification","tool_id":"call_p4bs9whl4j3kr8ksmkfyl661","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":246}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tools available: 16","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":273}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: contact_get_info","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: contact_get_new_list","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: contact_list_friends","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: contact_my_groups","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: contact_pass_friend_apply","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: contact_refuse_friend_apply","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: contact_search_groups","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: contact_search_users","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: get_current_time","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: group_get_info","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: group_get_members","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: group_join","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: group_leave","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: list_my_agents","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: list_supported_events","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool: push_notification","func":"pipeline.(*JobExecutionPipeline).invokeTool","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":279}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tool executed","tool_name":"push_notification","tool_result":"Tool not found","func":"pipeline.(*JobExecutionPipeline).toolsNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":227}
{"level":"info","ts":"2026-02-06T19:02:37.058+0800","msg":"job execution tools node done","session_id":"ASItIaSFgyxoP","tools_executed":1,"tools_ms":0,"func":"pipeline.(*JobExecutionPipeline).toolsNode","file":"C:/Users/chenjun/goProject/OmniLink/internal/modules/ai/infrastructure/pipeline/job_execution_graph.go","line":234}
