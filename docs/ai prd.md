1. 项目背景与目标
当前状态：项目是一个基于 Golang 的 IM 系统，已具备私聊、群聊、好友管理等基础通讯功能。 升级目标：在现有架构基础上，深度集成 AI 能力，打造一个 "AI-Native" 的即时通讯平台。不仅仅是简单的对话，而是包括 全能助手、自定义 Agent、即时辅助工具、智能指令 四大核心板块。

2. 核心功能需求 (Functional Requirements)
2.1 模块一：全局 AI 个人助手 (Global AI Assistant)
定义：每个用户专属的超级管家，拥有该用户的所有上帝视角（权限内）。

核心能力：

全域 RAG (Retrieval-Augmented Generation)：

数据源：好友列表、群组列表、所有历史聊天记录（私聊+群聊）。

场景：用户提问“我对张三在1月2号说了什么？总结一下”、“我是否向李四承诺过某事？”，AI 需检索历史记录并精准回答。

Agent Action (Function Calling)：

能力：通过自然语言调用 IM 内部 API。

场景：用户指令“帮我给王五发个消息说我不去了”、“帮我加入‘Golang交流群’”，AI 自动执行操作。

扩展性：未来需支持备忘录读写、日程管理等工具调用。

2.2 模块二：自定义 AI Agent 工厂 (Customizable AI Agents)
定义：用户创建和配置的独立 AI 实体。

核心能力：

角色扮演 (Persona Configuration)：用户可配置提示词 (System Prompt)，例如“萌妹子语气”、“严厉的老师”。

数字替身 (Digital Twin)：

模仿学习：支持读取与特定好友的聊天记录，分析语言风格，创建一个模仿该好友语气的 AI。

私有知识库 (Personal Knowledge Base)：

用户上传文档 (PDF/MD/TXT)，系统自动进行切片 (Chunking) 和 向量化 (Embedding) 存储。

该 Agent 聊天时仅基于该知识库回答问题。

2.3 模块三：AI 微服务/小工具 (AI Micro-Utilities)
定义：嵌入在 UI 交互流程中的轻量级 AI 功能，无处不在。

核心能力：

智能输入辅助：

消息补全：根据当前输入内容，预测后续文本。

输入润色：提供三个快捷操作——“更礼貌”、“翻译成英文”、“内容扩写”。

信息降噪：

群聊摘要：当群聊未读消息超过阈值（如 50 条），自动触发“AI 总结”，生成摘要展示给用户。

2.4 模块四：智能指令系统 (Smart Command System)
定义：基于 / 触发的快速意图识别与任务分发系统。

核心能力：

触发机制：在任意会话输入框输入 / 弹起智能菜单。

NLP 解析：支持自然语言参数。例如 /todo 明早10点提醒我开会。

任务调度：AI 解析时间与意图，创建定时任务。任务触发时，由 模块一（全局助手） 进行消息推送提醒。

3. 非功能性需求 (Non-functional Requirements)
架构一致性：AI 模块必须融入现有的 Golang 项目目录结构，避免破坏原有代码的整洁性。

高可扩展性 (Scalability)：

AI 服务层需设计为接口模式（Interface），支持切换底层模型（OpenAI, Claude, DeepSeek, 本地 Ollama 等）。

向量数据库需考虑未来数据量膨胀，设计合理的索引结构。

响应速度：输入辅助类功能（模块三）要求极低延迟，需考虑流式输出 (Streaming) 设计。

数据隐私：向量化存储的数据需包含 user_id 隔离，确保用户只能检索到自己的数据。